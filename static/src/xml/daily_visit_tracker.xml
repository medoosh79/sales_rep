<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    
    <!-- Daily Visit Tracker Template -->
    <t t-name="sales_rep_mgmt_pro.DailyVisitTracker" owl="1">
        <div class="daily-visit-tracker">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">
                    <i class="fa fa-map-marker-alt text-primary me-2"></i>
                    Daily Visit Tracker
                </h4>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary" t-on-click="updateLocation">
                        <i class="fa fa-location-arrow"></i> Update Location
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" t-on-click="loadVisits">
                        <i class="fa fa-refresh"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Current Visit Status -->
            <div t-if="state.isTracking" class="alert alert-warning mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong><i class="fa fa-clock"></i> Visit in Progress</strong>
                        <div class="mt-1">
                            <span class="badge bg-warning text-dark">Elapsed: <t t-esc="formatElapsedTime(state.elapsedTime)"/></span>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-sm btn-success" t-on-click="() => completeVisit(state.currentVisit, 'successful')">
                            <i class="fa fa-check"></i> Complete
                        </button>
                        <button class="btn btn-sm btn-danger" t-on-click="() => cancelVisit(state.currentVisit)">
                            <i class="fa fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Visits List -->
            <div class="row">
                <t t-foreach="state.visits" t-as="visit" t-key="visit.id">
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0 text-truncate" t-esc="visit.display_name"/>
                                <span t-attf-class="badge bg-{{getVisitStatusColor(visit.state)}}" t-esc="visit.state"/>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fa fa-user"></i> <t t-esc="visit.customer_id[1]"/>
                                    </small>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fa fa-clock"></i> Planned: <t t-esc="formatTime(visit.planned_time)"/>
                                    </small>
                                </div>
                                <div class="mb-2" t-if="visit.actual_start_time">
                                    <small class="text-muted">
                                        <i class="fa fa-play"></i> Started: <t t-esc="formatTime(visit.actual_start_time)"/>
                                    </small>
                                </div>
                                <div class="mb-2">
                                    <span t-attf-class="badge bg-{{visit.visit_type === 'sales' ? 'primary' : visit.visit_type === 'follow_up' ? 'info' : 'secondary'}}">
                                        <t t-esc="visit.visit_type"/>
                                    </span>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group w-100" t-if="visit.state === 'planned'">
                                    <button class="btn btn-sm btn-primary" t-on-click="() => startVisit(visit.id)">
                                        <i class="fa fa-play"></i> Start
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" t-on-click="() => rescheduleVisit(visit.id, visit.planned_time + 1)">
                                        <i class="fa fa-calendar"></i> Reschedule
                                    </button>
                                </div>
                                <div class="btn-group w-100" t-if="visit.state === 'in_progress' and visit.id !== state.currentVisit">
                                    <button class="btn btn-sm btn-success" t-on-click="() => completeVisit(visit.id, 'successful')">
                                        <i class="fa fa-check"></i> Complete
                                    </button>
                                    <button class="btn btn-sm btn-danger" t-on-click="() => cancelVisit(visit.id)">
                                        <i class="fa fa-times"></i> Cancel
                                    </button>
                                </div>
                                <div t-if="visit.state === 'completed'" class="text-center">
                                    <small class="text-success">
                                        <i class="fa fa-check-circle"></i> Completed
                                    </small>
                                </div>
                                <div t-if="visit.state === 'cancelled'" class="text-center">
                                    <small class="text-danger">
                                        <i class="fa fa-times-circle"></i> Cancelled
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </div>
            
            <!-- Empty State -->
            <div t-if="!state.visits.length" class="text-center py-5">
                <div class="text-muted">
                    <i class="fa fa-calendar-times fa-3x mb-3"></i>
                    <h5>No visits scheduled for today</h5>
                    <p>Create a daily visit schedule to start tracking visits.</p>
                </div>
            </div>
            
            <!-- Location Status -->
            <div class="mt-4 p-3 bg-light rounded" t-if="state.location">
                <h6><i class="fa fa-map-marker-alt text-success"></i> Current Location</h6>
                <small class="text-muted">
                    Lat: <t t-esc="state.location.latitude.toFixed(6)"/>, 
                    Lng: <t t-esc="state.location.longitude.toFixed(6)"/>
                </small>
            </div>
        </div>
    </t>
    
</templates>